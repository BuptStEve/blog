title: 「8」Redux 进阶 - react 全家桶学习笔记（二）
date: 2017-01-02 00:48:29
updated: 2017-01-02 00:48:29
categories: 前端
tags: [Redux, React, JavaScript]
---

## 零、前言
**参考资料**
* [英文原版文档](http://redux.js.org/)
* [中文文档](http://cn.redux.js.org/)
* [Dan Abramov - how to dispatch a redux action with a timeout](http://stackoverflow.com/questions/35411423/how-to-dispatch-a-redux-action-with-a-timeout/35415559#35415559)
* [阮一峰 - Redux 入门教程（二）：中间件与异步操作](http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_two_async_operations.html)
* [Redux 莞式教程](https://github.com/kenberkeley/redux-simple-tutorial/blob/master/redux-advanced-tutorial.md)
* [Thunk 函数的含义和用法](http://www.ruanyifeng.com/blog/2015/05/thunk.html)

在上一篇中介绍了 Redux 的各项基础 api。接着一步一步地介绍如何与 React 进行结合，并从引入过程中遇到的各个痛点引出 react-redux 的作用和原理。

不过目前为止还都是纸上谈兵，在日常的开发中最常见异步操作（如通过 ajax、jsonp 等方法 获取数据），在学习完上一篇后你可能依然没有头绪。因此本文将深入浅出地对于 redux 的进阶用法进行介绍。

## 一、中间件(MiddleWare)
### 1.1. 日志应用场景（该部分参考自[Redux 文档](http://cn.redux.js.org/docs/advanced/Middleware.html)）
因为改变 store 的唯一方法就是 dispatch 一个 action，所以现在我们将每次 dispatch 操作都打印出来作为操作日志，这样一来就可以很容易地看出是哪一次 dispatch 导致了异常。

#### 1.1.1. 第一次尝试：强行怼...
```js
let action = addTodo('Use Redux');

console.log('dispatching', action);
store.dispatch(action);
console.log('next state', store.getState());
```

显然这种在每一个 dispatch 操作的前后都手动加代码的方法，简直让人不忍直视...

#### 1.1.2. 第二次尝试：封装 dispatch
聪明的你一定马上又想到了，不如将上述代码封装成一个函数，然后直接调用该方法。

```js
function dispatchAndLog(store, action) {
  console.log('dispatching', action);
  store.dispatch(action);
  console.log('next state', store.getState());
}

dispatchAndLog(store, addTodo('Use Redux'));
```

矮油，看起来不错哟。不过每次使用都需要导入这个额外的方法，一旦不想使用又要全部替换回去...

#### 1.1.3. 第三次尝试：猴子补丁（Monkey Patch）
在此暂不探究为啥就叫猴子补丁而不是什么其他补丁。

简单来说猴子补丁指的就是，以替换原函数的方式为其添加新特性或修复 bug。

```js
let next = store.dispatch;

store.dispatch = function dispatchAndLog(action) {
  console.log('dispatching', action);
  let result = next(action);
  console.log('next state', store.getState());

  return result;
}
```

这样一来我们将原 dispatch “偷梁换柱”地添加了输出 log 功能。

#### 1.1.3. 第三次尝试：猴子补丁（Monkey Patch）


## 二、异步操作
### 2.1.

## 三、项目结构
### 3.1.

## 四、总结


以上 to be continued...
